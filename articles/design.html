<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design • vlbuildr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Design">
<meta property="og:description" content="vlbuildr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vlbuildr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/articles/introduction.html">Getting Started</a>
</li>
<li>
  <a href="../articles/design.html">Design</a>
</li>
<li>
  <a href="../articles/articles/examples.html">Examples</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vegawidget/vlbuildr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="design_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Design</h1>
            
            <h4 class="date">2021-11-14</h4>
      
      
      <div class="hidden name"><code>design.Rmd</code></div>

    </div>

    
    
<div id="a-functional-approach-to-building-up-specs" class="section level1">
<h1 class="hasAnchor">
<a href="#a-functional-approach-to-building-up-specs" class="anchor"></a>A functional approach to building up specs</h1>
<p>This package seeks to build up a library of functions that can iteratively build up a Vega-Lite spec. There is an initializer function <code>vl_chart</code> that initializes the chart (and can optionally take in values for top-level spec attributes), and then subsequent functions can add various component to a spec – they take in a spec as input as well as arguments relating to the new component and return a modified spec with the new component.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vegawidget.github.io/vlbuildr/index.html">vlbuildr</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/vl_chart.html">vl_chart</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
   <span class="fu"><a href="../reference/vl_add_data.html">vl_add_data</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
   <span class="fu"><a href="../reference/vl_mark_point.html">vl_mark_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
   <span class="fu"><a href="../reference/vl_encode_x.html">vl_encode_x</a></span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
   <span class="fu"><a href="../reference/vl_encode_y.html">vl_encode_y</a></span><span class="op">(</span><span class="st">"mpg"</span><span class="op">)</span></code></pre></div>
<p>For a more thorough introduction to how to use the package, see <a href="https://vegawidget.github.io/vlbuildr/articles/articles/introduction.html">introduction vignette</a>. For example charts see the <a href="https://vegawidget.github.io/vlbuildr/articles/articles/examples.html">examples vignette</a>.</p>
<div id="underlying-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#underlying-objects" class="anchor"></a>Underlying objects</h2>
<p>At the moment, the various top-level specs are S3 classes that are basically treated as lists. A few of the internal functions take advantage of the classes to help determine the right way to add a component.</p>
<p>There currently are no classes for any sub-components of a spec, e.g. a class that might correspond to an “Axis” definition from the Vega-Lite spec. Rather, functions build those components as lists, and the validity is checked using the schema.</p>
<p>Moving to an approach where actual classes are defined for each potential object is a possibility. The motivation for such an approach would be cleaner internal handing rather than a substantially different API, as this package would seek to primarily present to users a functional interface for building up specs. The user-facing aspect that would be most likely to change would be what is described in the following section</p>
<div id="making-sub-components" class="section level3">
<h3 class="hasAnchor">
<a href="#making-sub-components" class="anchor"></a>Making sub-components</h3>
<p>The package currently offer a number of functions grouped in a list <code>vl</code> (e.g. <code>vl$BinParams</code>) which make a given sub-component of a Vega-Lite spec (what could map to an object if taking a more Object-oriented approach). These functions are intended to build sub-components that can be passed as arguments to functions that add to a spec.</p>
<p>However, the intention is to make the functions that add to a spec granular enough that in general most won’t need complicated nested objects to be taken in as arguments, so that in most cases these <code>vl$</code> functions won’t be needed.</p>
<p>This part of the API might change, especially if the internal components are reworked to make use of objects corresponding to these sub-components.</p>
</div>
</div>
<div id="correctness-of-specs-being-built" class="section level2">
<h2 class="hasAnchor">
<a href="#correctness-of-specs-being-built" class="anchor"></a>Correctness of specs being built</h2>
<p>This package may build incorrect specs if given improper inputs or if not all needed components are added to a spec. Some protection against this has been added by adding sub-schema validation. When a function adds a component to a spec, it checks that the component is correct. That checking will give a warning for an invalid spec; another area of improvement would be giving more detailed error messages. The validation may also still be imperfect. It also may be possible to add invalid combinations of individual components to a spec, and the overall spec is not currently validated.</p>
<p>Potentially validation could also occur prior to printing (to check the validity of the entire spec), but that might be something to add to the vegawdiget package, which handles the printing.</p>
</div>
</div>
<div id="construction-of-the-package" class="section level1">
<h1 class="hasAnchor">
<a href="#construction-of-the-package" class="anchor"></a>Construction of the package</h1>
<div id="a-semi-automated-approach-to-building-an-api" class="section level2">
<h2 class="hasAnchor">
<a href="#a-semi-automated-approach-to-building-an-api" class="anchor"></a>A semi-automated approach to building an API</h2>
<p>The functions in this package are build up using a semi-automated approach. A companion package <a href="https://github.com/vegawidget/vlbuildr/tree/master/build/vlmetabuildr">vlmetabuildr</a> located inside the ‘build’ directory is used to write the functions in the ‘zzz_autogen_api.R’ file.</p>
<p>Note that this process is very much <strong>semi</strong>-automated and not fully automated. vlmetabuildr has been made specific for the Vega-lite api and this package and is not a general purpose JSON Schema –&gt; API package.</p>
<p>Specific patterns for building up an API (e.g. groups of functions) are identified, such as adding an encoding via <code>vl_encode_&lt;channel&gt;</code> functions for each channel. A function for adding an encoding to a spec generally is hand-crafted and built within this package. The vlmetabuildr package will then make functions for (1) identifying all channels that need such a function, and (2) building up a function for each channel that has the appropriate arguments and documentations pulled from the Vega-lite schema.</p>
<p>In summary, what <strong>is not</strong> automated includes:</p>
<ul>
<li>Identifying what general groups of functions needed for adding to a spec</li>
<li>Mapping types of functions with where in the schema to pull the reqiurements</li>
<li>The internal functions for adding a category of components to a spec</li>
</ul>
<p>What <strong>is</strong> automated includes:</p>
<ul>
<li>Figuring out all the varieties of a group of functions, e.g. what all the channels are that should get an encode function</li>
<li>Adding the right parameters to a function based on the requirements in the schema</li>
<li>Adding documentation for parameters based on descriptions from the schema</li>
</ul>
<p>The parts that are automated would be extremely tedious to do manually. Potentially more of the API construction could be automated, however, the difficulty of the automation would increase substantially and/or the resulting API might be clunkier.</p>
</div>
<div id="details" class="section level2">
<h2 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h2>
<div id="build-the-auto-generated-components" class="section level3">
<h3 class="hasAnchor">
<a href="#build-the-auto-generated-components" class="anchor"></a>Build the auto-generated components</h3>
<p>There is a script ‘build/build.R’ that builds the auto-generated components of the package.</p>
</div>
<div id="stucture-of-adder-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#stucture-of-adder-functions" class="anchor"></a>Stucture of ‘adder’ functions</h3>
<p>Most of the auto-generated functions will call an internal function to add the specified component to the spec. Those functions generally take as argument at least three arguments: (1) the old spec, (2) the new object to add (a list), (3) a reference within the schema of what the object corresponds to. Additionally, more arguments needed to specify how the component should get added might also be included. The adder function will generally validate the object.</p>
</div>
<div id="pulling-bits-from-the-schema" class="section level3">
<h3 class="hasAnchor">
<a href="#pulling-bits-from-the-schema" class="anchor"></a>Pulling bits from the schema</h3>
<p>Functions for pulling out what properties are available for a particular part of the Vega-Lite schema are in the schema.R file in <code>vlmetabuildr</code>. These functions can recursively travel through the schema to pull out all the available enums, properties, or requirements for a particular component of a schema. These functions were adapted from similar functions in javascript from the vega-lite-api package.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alicia Schep, Vega-Lite Developers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
